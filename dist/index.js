var pe=Object.defineProperty,ce=Object.defineProperties;var fe=Object.getOwnPropertyDescriptors;var ie=Object.getOwnPropertySymbols;var ye=Object.prototype.hasOwnProperty,Fe=Object.prototype.propertyIsEnumerable;var re=(a,e,t)=>e in a?pe(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,F=(a,e)=>{for(var t in e||(e={}))ye.call(e,t)&&re(a,t,e[t]);if(ie)for(var t of ie(e))Fe.call(e,t)&&re(a,t,e[t]);return a},h=(a,e)=>ce(a,fe(e));var ae=(a,e,t)=>{if(!e.has(a))throw TypeError("Cannot "+t)};var i=(a,e,t)=>(ae(a,e,"read from private field"),t?t.call(a):e.get(a)),o=(a,e,t)=>{if(e.has(a))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(a):e.set(a,t)},l=(a,e,t,r)=>(ae(a,e,"write to private field"),r?r.call(a,t):e.set(a,t),t);var N={autoTrim:!0,emailRegex:/^[A-Z0-9]+(?:[_%+.-][A-Z0-9]+)*@[A-Z0-9]+(?:[.-][A-Z0-9]+)\.[A-Z]{2,}$/i};function se(a,e){let t=N.emailRegex;return r=>{N.autoTrim&&(r=r.trim());let s={isValid:t.test(r)};return s.isValid?e&&(s.message=e):s.message=a,s}}function oe(a,e){return t=>{N.autoTrim&&(t=t.trim());let r={isValid:t.length>0};return r.isValid?e&&(r.message=e):r.message=a,r}}import"reflect-metadata";import{Container as ve}from"inversify";import{helpers as ee}from"inversify-vanillajs-helpers";var M,x=class{constructor(){o(this,M,{})}get formElementMap(){return i(this,M)}registerFormElement(e,t){i(this,M)[e]=t}};M=new WeakMap;import{Observable as he,from as ge}from"rxjs";function k(a){process.env.NODE_ENV==="development"&&console.error(a)}var v,P,u,z=class{constructor(e,t){o(this,v,void 0);o(this,P,void 0);o(this,u,{});l(this,v,e),l(this,P,t)}evaluate(e){this.unsubscribeAll();let t={syncResult:{value:e,validity:2,messages:[{type:"PENDING",text:i(this,P)}]}};return t.observable=new he(r=>{let s={value:e,validity:4,messages:[]};for(let m=0;m<i(this,v).length;m++){let c=i(this,v)[m];try{let d=c(e),te=ge(d).subscribe(this.createValidatorObserver(s,r,m));i(this,u)[m]=te}catch(d){this.createValidatorObserverErrorMethod(s,r)(d)}}}),t}createValidatorObserver(e,t,r){return{next:this.createValidatorObserverNextMethod(e,t,r),error:this.createValidatorObserverErrorMethod(e,t)}}createValidatorObserverNextMethod(e,t,r){return m=>{let{isValid:c,message:d}=m;c?(d&&e.messages.push({type:"VALID",text:d}),this.unsubscribeById(r),this.allValidatorsCompleted()&&(t.next(e),t.complete())):(this.unsubscribeAll(),e.validity=1,d&&e.messages.push({type:"INVALID",text:d}),t.next(e),t.complete())}}createValidatorObserverErrorMethod(e,t){return s=>{this.unsubscribeAll(),k(s),e.validity=0,e.messages.push({type:"ERROR",text:"An unexpected error occurred while validating the field."}),t.next(e),t.complete()}}unsubscribeAll(){for(let e in i(this,u))i(this,u)[e].unsubscribe();l(this,u,{})}unsubscribeById(e){i(this,u)[e].unsubscribe(),delete i(this,u)[e]}allValidatorsCompleted(){return Object.keys(i(this,u)).length===0}};v=new WeakMap,P=new WeakMap,u=new WeakMap;var O,B,q=class{constructor(e,t){o(this,O,void 0);o(this,B,void 0);l(this,O,e),l(this,B,t)}evaluate(e){let t=i(this,O).evaluate(e);if(t.syncResult.validity<=1)return t;let r=i(this,B).evaluate(e);return{syncResult:{value:r.syncResult.value,validity:r.syncResult.validity,messages:[...t.syncResult.messages,...r.syncResult.messages]},observable:r.observable}}};O=new WeakMap,B=new WeakMap;var L,K=class{constructor(e){o(this,L,void 0);l(this,L,e)}evaluate(e){return{syncResult:this.evaluateSync(e)}}evaluateSync(e){let t={value:e,validity:4,messages:[]};try{for(let r of i(this,L)){let{isValid:s,message:m}=r(e);s||(t.validity=1),m&&t.messages.push({type:s?"VALID":"INVALID",text:m})}}catch(r){k(r),t.validity=0,t.messages.push({type:"ERROR",text:"An unexpected error occurred while validating the field."})}return t}};L=new WeakMap;var _=class{createSingleInputValidatorSuite(e,t,r="Checking field..."){let s=new K(e);if(t.length>0){let m=new z(t,r);return e.length>0?new q(s,m):m}else return s}};import{BehaviorSubject as Ve}from"rxjs";var p,f,I,J=class{constructor(e,t,r){o(this,p,!1);o(this,f,void 0);o(this,I,void 0);this.primaryField=e,this.secondaryField=t,l(this,I,r),l(this,f,i(this,I)),this.primaryField.stateChanges.subscribe(()=>{var s;i(this,p)||(s=this.stateChanges)==null||s.next(this.state)}),this.secondaryField.stateChanges.subscribe(()=>{var s;i(this,p)&&((s=this.stateChanges)==null||s.next(this.state))}),this.stateChanges=new Ve(this.state)}get state(){let e=i(this,p)?this.secondaryField.state:this.primaryField.state;return e.useSecondaryField=i(this,p),e.omit=i(this,f),e}set useSecondaryField(e){let t=this.useSecondaryField!==e;l(this,p,e),this.stateChanges&&t&&this.stateChanges.next(this.state)}get useSecondaryField(){return i(this,p)}set omit(e){var t;l(this,f,e),(t=this.stateChanges)==null||t.next(this.state)}get omit(){return i(this,f)}setValue(e){e.primaryFieldValue&&this.primaryField.setValue(e.primaryFieldValue),e.secondaryFieldValue&&this.secondaryField.setValue(e.secondaryFieldValue),e.useSecondaryField!==void 0&&(this.useSecondaryField=e.useSecondaryField)}setState(e){e.omit!==void 0&&(this.omit=e.omit),e.primaryFieldState&&this.primaryField.setState(e.primaryFieldState),e.secondaryFieldState&&this.secondaryField.setState(e.secondaryFieldState),e.useSecondaryField!==void 0&&(this.useSecondaryField=e.useSecondaryField)}reset(){l(this,f,i(this,I)),this.primaryField.reset(),this.secondaryField.reset(),this.useSecondaryField=!1}};p=new WeakMap,f=new WeakMap,I=new WeakMap;import{BehaviorSubject as Se}from"rxjs";function w(a){return JSON.parse(JSON.stringify(a))}var D,T,E,g,V,Y=class{constructor(e,t,r){o(this,D,void 0);o(this,T,void 0);o(this,E,void 0);o(this,g,void 0);o(this,V,void 0);l(this,D,e),l(this,T,t),l(this,E,r);let s=i(this,D).evaluate(i(this,T));l(this,g,h(F({},s.syncResult),{omit:i(this,E)})),this.stateChanges=new Se(this.state),s.observable&&this.handleValidityObservable(s.observable)}get state(){return w(i(this,g))}set omit(e){this.setState(h(F({},this.state),{omit:e}))}get omit(){return this.state.omit}setValue(e){i(this,V)&&i(this,V).unsubscribe();let t=i(this,D).evaluate(e);this.setState(h(F({},t.syncResult),{omit:this.state.omit})),t.observable&&this.handleValidityObservable(t.observable)}setState(e){l(this,g,w(e)),this.stateChanges.next(this.state)}reset(){i(this,g).omit=i(this,E),this.setValue(i(this,T))}handleValidityObservable(e){var t;(t=i(this,V))==null||t.unsubscribe(),l(this,V,e.subscribe(r=>{this.setState(h(F({},r),{messages:[...this.state.messages.filter(s=>s.type!=="PENDING"),...r.messages],omit:this.state.omit}))}))}};D=new WeakMap,T=new WeakMap,E=new WeakMap,g=new WeakMap,V=new WeakMap;var Z,j=class{constructor(e){o(this,Z,void 0);l(this,Z,e)}createField(e,t,r,s,m){let c=i(this,Z).createSingleInputValidatorSuite(r,s,m);return new Y(c,e,t)}createDualField(e,t,r,s,m,c){let d=this.createField(e,!1,s,m,c),te=this.createField(t,!1,s,m,c);return new J(d,te,r)}};Z=new WeakMap;import{BehaviorSubject as be}from"rxjs";var S,A,R,y,G=class{constructor(e,t,r,s){o(this,S,void 0);o(this,A,void 0);o(this,R,void 0);o(this,y,void 0);this.userFacingFields=e,l(this,S,t),l(this,A,r),l(this,R,s),l(this,y,i(this,R)),i(this,A).messagesChanges.subscribe(()=>{var m;(m=this.stateChanges)==null||m.next(this.state)}),i(this,S).stateChanges.subscribe(()=>{var m;this.stateChanges&&((m=this.stateChanges)==null||m.next(this.state))}),this.stateChanges=new be(this.state)}get state(){return w(h(F({},i(this,S).state),{messages:[...i(this,A).messages,...i(this,S).state.messages],omit:i(this,y)}))}set omit(e){l(this,y,e),this.stateChanges&&this.stateChanges.next(this.state)}get omit(){return i(this,y)}reset(){l(this,y,i(this,R));for(let e in this.userFacingFields)this.userFacingFields[e].reset()}};S=new WeakMap,A=new WeakMap,R=new WeakMap,y=new WeakMap;var n,$=class{constructor(e){o(this,n,void 0);l(this,n,e),this.checkTemplate()}get isNestedForm(){return i(this,n)instanceof G}get isDualField(){return!this.isNestedForm&&typeof i(this,n)!="string"&&!("defaultValue"in i(this,n))}get isStateControlledField(){return!this.isNestedForm&&typeof i(this,n)!="string"&&"stateControlFn"in i(this,n)}get isValueControlledField(){return!this.isNestedForm&&typeof i(this,n)!="string"&&"valueControlFn"in i(this,n)}get baseObject(){return this.isNestedForm?i(this,n):this.isDualField?this.createBaseDualFieldObj():this.createBaseFieldObj()}get stateControlFn(){return this.isStateControlledField?i(this,n).stateControlFn:void 0}get valueControlFn(){return this.isValueControlledField?i(this,n).valueControlFn:void 0}checkTemplate(){if(!(typeof i(this,n)=="string"||i(this,n)instanceof G)){if(typeof i(this,n)!="object")throw new Error(`FieldTemplateParser expected to receive argument of type <string | NestedFormImpl | object>. Received ${typeof i(this,n)}.`);if(!("defaultValue"in i(this,n))&&!("primaryDefaultValue"in i(this,n)&&"secondaryDefaultValue"in i(this,n)))throw new Error("Object passed to FormTemplateParser did not include properties defaultValue or both primaryDefaultValue and secondaryDefaultValue.");if("defaultValue"in i(this,n)&&("primaryDefaultValue"in i(this,n)||"secondaryDefaultValue"in i(this,n)))throw new Error("FieldTemplateParser received ambiguous object. Include only defaultValue or both primaryDefaultValue and secondaryDefaultValue.");if("stateControlFn"in i(this,n)&&"valueControlFn"in i(this,n))throw new Error("FieldTemplateParser received ambiguous object. Include only stateControlFn or valueControlFn.")}}createBaseFieldObj(){if(typeof i(this,n)=="string")return{defaultValue:i(this,n),syncValidators:[],asyncValidators:[],omitByDefault:!1};{let e=i(this,n);return{defaultValue:e.defaultValue,syncValidators:e.syncValidators?e.syncValidators:[],asyncValidators:e.asyncValidators?e.asyncValidators:[],omitByDefault:e.omitByDefault,pendingAsyncValidatorMessage:e.pendingAsyncValidatorMessage}}}createBaseDualFieldObj(){let e=i(this,n);return{primaryDefaultValue:e.primaryDefaultValue,secondaryDefaultValue:e.secondaryDefaultValue,syncValidators:e.syncValidators?e.syncValidators:[],asyncValidators:e.asyncValidators?e.asyncValidators:[],omitByDefault:e.omitByDefault,pendingAsyncValidatorMessage:e.pendingAsyncValidatorMessage}}};n=new WeakMap;var C,b,H,Q,W,X,U=class{constructor(e){o(this,C,void 0);o(this,b,{});o(this,H,new Map);o(this,Q,new Map);o(this,W,new Map);o(this,X,new Map);l(this,C,e)}parseTemplate(e){for(let t in e){let r=new $(e[t]);if(r.isNestedForm)i(this,b)[t]=r.baseObject;else if(r.isDualField){let s=r.baseObject;i(this,b)[t]=i(this,C).createDualField(s.primaryDefaultValue,s.secondaryDefaultValue,s.omitByDefault,s.syncValidators,s.asyncValidators,s.pendingAsyncValidatorMessage),r.stateControlFn?i(this,W).set(t,r.stateControlFn):r.valueControlFn&&i(this,X).set(t,r.valueControlFn)}else{let s=r.baseObject;i(this,b)[t]=i(this,C).createField(s.defaultValue,s.omitByDefault,s.syncValidators,s.asyncValidators,s.pendingAsyncValidatorMessage),r.stateControlFn?i(this,H).set(t,r.stateControlFn):r.valueControlFn&&i(this,Q).set(t,r.valueControlFn)}}return i(this,b)}};C=new WeakMap,b=new WeakMap,H=new WeakMap,Q=new WeakMap,W=new WeakMap,X=new WeakMap;ee.annotate(x);ee.annotate(_);ee.annotate(j,["SingleInputValidatorFactory"]);ee.annotate(U,["BaseFieldFactory"]);function de(){let a=new ve;return a.bind("FormElementRegistry").to(x).inTransientScope(),a.bind("SingleInputValidatorFactory").to(_).inSingletonScope(),a.bind("BaseFieldFactory").to(j).inSingletonScope(),a.bind("FormElementsParser").to(U).inTransientScope(),a}var Ie=de(),De=Ie.get("FormElementsParser"),ue=De.parseTemplate({fieldA:"a field",fieldB:{defaultValue:"field b",syncValidators:[oe("Field B is required."),se("Field B must be an email.")]},fieldC:{defaultValue:"field c",valueControlFn:({fieldB:a})=>a.value.toUpperCase()},fieldD:{primaryDefaultValue:"field d",secondaryDefaultValue:"FIELD D",omitByDefault:!0}});for(let a in ue)console.log(a),console.log(ue[a].state);
//# sourceMappingURL=index.js.map