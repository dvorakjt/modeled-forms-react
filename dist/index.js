var fe=Object.defineProperty,he=Object.defineProperties;var ge=Object.getOwnPropertyDescriptors;var oe=Object.getOwnPropertySymbols;var Se=Object.prototype.hasOwnProperty,Ve=Object.prototype.propertyIsEnumerable;var le=(a,e,i)=>e in a?fe(a,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[e]=i,f=(a,e)=>{for(var i in e||(e={}))Se.call(e,i)&&le(a,i,e[i]);if(oe)for(var i of oe(e))Ve.call(e,i)&&le(a,i,e[i]);return a},h=(a,e)=>he(a,ge(e));var ne=(a,e,i)=>{if(!e.has(a))throw TypeError("Cannot "+i)};var t=(a,e,i)=>(ne(a,e,"read from private field"),i?i.call(a):e.get(a)),o=(a,e,i)=>{if(e.has(a))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(a):e.set(a,i)},n=(a,e,i,r)=>(ne(a,e,"write to private field"),r?r.call(a,i):e.set(a,i),i);var N={autoTrim:!0,emailRegex:/^[A-Z0-9]+(?:[_%+.-][A-Z0-9]+)*@[A-Z0-9]+(?:[.-][A-Z0-9]+)\.[A-Z]{2,}$/i};function de(a,e){let i=N.emailRegex;return r=>{N.autoTrim&&(r=r.trim());let s={isValid:i.test(r)};return s.isValid?e&&(s.message=e):s.message=a,s}}function me(a,e){return i=>{N.autoTrim&&(i=i.trim());let r={isValid:i.length>0};return r.isValid?e&&(r.message=e):r.message=a,r}}import"reflect-metadata";import{Container as be}from"inversify";import{helpers as ae}from"inversify-vanillajs-helpers";var x,M=class{constructor(){o(this,x,{})}get formElementMap(){return t(this,x)}registerFormElement(e,i){t(this,x)[e]=i}};x=new WeakMap;import{Observable as Ce,from as De}from"rxjs";function k(a){process.env.NODE_ENV==="development"&&console.error(a)}var D,P,u,z=class{constructor(e,i){o(this,D,void 0);o(this,P,void 0);o(this,u,{});n(this,D,e),n(this,P,i)}evaluate(e){this.unsubscribeAll();let i={syncResult:{value:e,validity:2,messages:[{type:"PENDING",text:t(this,P)}]}};return i.observable=new Ce(r=>{let s={value:e,validity:4,messages:[]};for(let d=0;d<t(this,D).length;d++){let p=t(this,D)[d];try{let m=p(e),se=De(m).subscribe(this.createValidatorObserver(s,r,d));t(this,u)[d]=se}catch(m){this.createValidatorObserverErrorMethod(s,r)(m)}}}),i}createValidatorObserver(e,i,r){return{next:this.createValidatorObserverNextMethod(e,i,r),error:this.createValidatorObserverErrorMethod(e,i)}}createValidatorObserverNextMethod(e,i,r){return d=>{let{isValid:p,message:m}=d;p?(m&&e.messages.push({type:"VALID",text:m}),this.unsubscribeById(r),this.allValidatorsCompleted()&&(i.next(e),i.complete())):(this.unsubscribeAll(),e.validity=1,m&&e.messages.push({type:"INVALID",text:m}),i.next(e),i.complete())}}createValidatorObserverErrorMethod(e,i){return s=>{this.unsubscribeAll(),k(s),e.validity=0,e.messages.push({type:"ERROR",text:"An unexpected error occurred while validating the field."}),i.next(e),i.complete()}}unsubscribeAll(){for(let e in t(this,u))t(this,u)[e].unsubscribe();n(this,u,{})}unsubscribeById(e){t(this,u)[e].unsubscribe(),delete t(this,u)[e]}allValidatorsCompleted(){return Object.keys(t(this,u)).length===0}};D=new WeakMap,P=new WeakMap,u=new WeakMap;var O,B,q=class{constructor(e,i){o(this,O,void 0);o(this,B,void 0);n(this,O,e),n(this,B,i)}evaluate(e){let i=t(this,O).evaluate(e);if(i.syncResult.validity<=1)return i;let r=t(this,B).evaluate(e);return{syncResult:{value:r.syncResult.value,validity:r.syncResult.validity,messages:[...i.syncResult.messages,...r.syncResult.messages]},observable:r.observable}}};O=new WeakMap,B=new WeakMap;var L,K=class{constructor(e){o(this,L,void 0);n(this,L,e)}evaluate(e){return{syncResult:this.evaluateSync(e)}}evaluateSync(e){let i={value:e,validity:4,messages:[]};try{for(let r of t(this,L)){let{isValid:s,message:d}=r(e);s||(i.validity=1),d&&i.messages.push({type:s?"VALID":"INVALID",text:d})}}catch(r){k(r),i.validity=0,i.messages.push({type:"ERROR",text:"An unexpected error occurred while validating the field."})}return i}};L=new WeakMap;var w=class{createSingleInputValidatorSuite(e,i,r="Checking field..."){let s=new K(e);if(i.length>0){let d=new z(i,r);return e.length>0?new q(s,d):d}else return s}};import{BehaviorSubject as Ae}from"rxjs";var c,y,A,J=class{constructor(e,i,r){o(this,c,!1);o(this,y,void 0);o(this,A,void 0);this.primaryField=e,this.secondaryField=i,n(this,A,r),n(this,y,t(this,A)),this.primaryField.stateChanges.subscribe(()=>{var s;t(this,c)||(s=this.stateChanges)==null||s.next(this.state)}),this.secondaryField.stateChanges.subscribe(()=>{var s;t(this,c)&&((s=this.stateChanges)==null||s.next(this.state))}),this.stateChanges=new Ae(this.state)}get state(){let e=t(this,c)?this.secondaryField.state:this.primaryField.state;return e.useSecondaryField=t(this,c),e.omit=t(this,y),e}set useSecondaryField(e){let i=this.useSecondaryField!==e;n(this,c,e),this.stateChanges&&i&&this.stateChanges.next(this.state)}get useSecondaryField(){return t(this,c)}set omit(e){var i;n(this,y,e),(i=this.stateChanges)==null||i.next(this.state)}get omit(){return t(this,y)}setValue(e){e.primaryFieldValue&&this.primaryField.setValue(e.primaryFieldValue),e.secondaryFieldValue&&this.secondaryField.setValue(e.secondaryFieldValue),e.useSecondaryField!==void 0&&(this.useSecondaryField=e.useSecondaryField)}setState(e){e.omit!==void 0&&(this.omit=e.omit),e.primaryFieldState&&this.primaryField.setState(e.primaryFieldState),e.secondaryFieldState&&this.secondaryField.setState(e.secondaryFieldState),e.useSecondaryField!==void 0&&(this.useSecondaryField=e.useSecondaryField)}reset(){n(this,y,t(this,A)),this.primaryField.reset(),this.secondaryField.reset(),this.useSecondaryField=!1}};c=new WeakMap,y=new WeakMap,A=new WeakMap;import{BehaviorSubject as Ie}from"rxjs";function _(a){return JSON.parse(JSON.stringify(a))}var I,T,b,g,S,Y=class{constructor(e,i,r){o(this,I,void 0);o(this,T,void 0);o(this,b,void 0);o(this,g,void 0);o(this,S,void 0);n(this,I,e),n(this,T,i),n(this,b,r);let s=t(this,I).evaluate(t(this,T));n(this,g,h(f({},s.syncResult),{omit:t(this,b)})),this.stateChanges=new Ie(this.state),s.observable&&this.handleValidityObservable(s.observable)}get state(){return _(t(this,g))}set omit(e){this.setState(h(f({},this.state),{omit:e}))}get omit(){return this.state.omit}setValue(e){t(this,S)&&t(this,S).unsubscribe();let i=t(this,I).evaluate(e);this.setState(h(f({},i.syncResult),{omit:this.state.omit})),i.observable&&this.handleValidityObservable(i.observable)}setState(e){n(this,g,_(e)),this.stateChanges.next(this.state)}reset(){t(this,g).omit=t(this,b),this.setValue(t(this,T))}handleValidityObservable(e){var i;(i=t(this,S))==null||i.unsubscribe(),n(this,S,e.subscribe(r=>{this.setState(h(f({},r),{messages:[...this.state.messages.filter(s=>s.type!=="PENDING"),...r.messages],omit:this.state.omit}))}))}};I=new WeakMap,T=new WeakMap,b=new WeakMap,g=new WeakMap,S=new WeakMap;var Z,j=class{constructor(e){o(this,Z,void 0);n(this,Z,e)}createField(e,i,r,s,d){let p=t(this,Z).createSingleInputValidatorSuite(r,s,d);return new Y(p,e,i)}createDualField(e,i,r,s,d,p){let m=this.createField(e,!1,s,d,p),se=this.createField(i,!1,s,d,p);return new J(m,se,r)}};Z=new WeakMap;import{BehaviorSubject as Te}from"rxjs";var V,v,E,F,G=class{constructor(e,i,r,s){o(this,V,void 0);o(this,v,void 0);o(this,E,void 0);o(this,F,void 0);this.userFacingFields=e,n(this,V,i),n(this,v,r),n(this,E,s),n(this,F,t(this,E)),t(this,v).messagesChanges.subscribe(()=>{var d;(d=this.stateChanges)==null||d.next(this.state)}),t(this,V).stateChanges.subscribe(()=>{var d;this.stateChanges&&((d=this.stateChanges)==null||d.next(this.state))}),this.stateChanges=new Te(this.state)}get state(){return _(h(f({},t(this,V).state),{messages:[...t(this,v).messages,...t(this,V).state.messages],omit:t(this,F)}))}set omit(e){n(this,F,e),this.stateChanges&&this.stateChanges.next(this.state)}get omit(){return t(this,F)}reset(){n(this,F,t(this,E));for(let e in this.userFacingFields)this.userFacingFields[e].reset()}};V=new WeakMap,v=new WeakMap,E=new WeakMap,F=new WeakMap;var l,$=class{constructor(e){o(this,l,void 0);n(this,l,e),this.checkTemplate()}get isNestedForm(){return t(this,l)instanceof G}get isDualField(){return!this.isNestedForm&&typeof t(this,l)!="string"&&!("defaultValue"in t(this,l))}get baseObject(){return this.isNestedForm?t(this,l):this.isDualField?this.createBaseDualFieldObj():this.createBaseFieldObj()}get syncValueControlFn(){if(this.isSyncValueControlledField)return(this.isDualField?t(this,l):t(this,l)).syncValueControlFn}get asyncValueControlFn(){if(this.isAsyncValueControlledField)return(this.isDualField?t(this,l):t(this,l)).asyncValueControlFn}get syncStateControlFn(){if(this.isSyncStateControlledField)return(this.isDualField?t(this,l):t(this,l)).syncStateControlFn}get asyncStateControlFn(){if(this.isAsyncStateControlledField)return(this.isDualField?t(this,l):t(this,l)).asyncStateControlFn}get isSyncStateControlledField(){return!this.isNestedForm&&typeof t(this,l)!="string"&&"syncStateControlFn"in t(this,l)}get isSyncValueControlledField(){return!this.isNestedForm&&typeof t(this,l)!="string"&&"syncValueControlFn"in t(this,l)}get isAsyncStateControlledField(){return!this.isNestedForm&&typeof t(this,l)!="string"&&"asyncStateControlFn"in t(this,l)}get isAsyncValueControlledField(){return!this.isNestedForm&&typeof t(this,l)!="string"&&"asyncValueControlFn"in t(this,l)}checkTemplate(){if(typeof t(this,l)=="string"||t(this,l)instanceof G)return;if(typeof t(this,l)!="object")throw new Error(`FieldTemplateParser expected to receive argument of type <string | NestedFormImpl | object>. Received ${typeof t(this,l)}.`);if(!("defaultValue"in t(this,l))&&!("primaryDefaultValue"in t(this,l)&&"secondaryDefaultValue"in t(this,l)))throw new Error("Object passed to FormTemplateParser did not include properties defaultValue or both primaryDefaultValue and secondaryDefaultValue.");if("defaultValue"in t(this,l)&&("primaryDefaultValue"in t(this,l)||"secondaryDefaultValue"in t(this,l)))throw new Error("FieldTemplateParser received ambiguous object. Include only defaultValue or both primaryDefaultValue and secondaryDefaultValue.");let e=0;if(this.isSyncStateControlledField&&e++,this.isSyncValueControlledField&&e++,this.isAsyncStateControlledField&&e++,this.isAsyncValueControlledField&&e++,e>1)throw new Error("FieldTemplateParser received ambiguous object. Include only one type of control function.")}createBaseFieldObj(){if(typeof t(this,l)=="string")return{defaultValue:t(this,l),syncValidators:[],asyncValidators:[],omitByDefault:!1};{let e=t(this,l);return{defaultValue:e.defaultValue,syncValidators:e.syncValidators?e.syncValidators:[],asyncValidators:e.asyncValidators?e.asyncValidators:[],omitByDefault:!!e.omitByDefault,pendingAsyncValidatorMessage:e.pendingAsyncValidatorMessage}}}createBaseDualFieldObj(){let e=t(this,l);return{primaryDefaultValue:e.primaryDefaultValue,secondaryDefaultValue:e.secondaryDefaultValue,syncValidators:e.syncValidators?e.syncValidators:[],asyncValidators:e.asyncValidators?e.asyncValidators:[],omitByDefault:!!e.omitByDefault,pendingAsyncValidatorMessage:e.pendingAsyncValidatorMessage}}};l=new WeakMap;var R,C,H,Q,W,X,ee,te,ie,re,U=class{constructor(e){o(this,R,void 0);o(this,C,{});o(this,H,new Map);o(this,Q,new Map);o(this,W,new Map);o(this,X,new Map);o(this,ee,new Map);o(this,te,new Map);o(this,ie,new Map);o(this,re,new Map);n(this,R,e)}parseTemplate(e){for(let i in e){let r=new $(e[i]);if(r.isNestedForm)t(this,C)[i]=r.baseObject;else if(r.isDualField){let s=r.baseObject;t(this,C)[i]=t(this,R).createDualField(s.primaryDefaultValue,s.secondaryDefaultValue,s.omitByDefault,s.syncValidators,s.asyncValidators,s.pendingAsyncValidatorMessage)}else{let s=r.baseObject;t(this,C)[i]=t(this,R).createField(s.defaultValue,s.omitByDefault,s.syncValidators,s.asyncValidators,s.pendingAsyncValidatorMessage)}r.syncStateControlFn?r.isDualField?t(this,ee).set(i,r.syncStateControlFn):t(this,H).set(i,r.syncStateControlFn):r.asyncStateControlFn?r.isDualField?t(this,ie).set(i,r.asyncStateControlFn):t(this,W).set(i,r.asyncStateControlFn):r.syncValueControlFn?r.isDualField?t(this,te).set(i,r.syncValueControlFn):t(this,Q).set(i,r.syncValueControlFn):r.asyncValueControlFn&&(r.isDualField?t(this,re).set(i,r.asyncValueControlFn):t(this,X).set(i,r.asyncValueControlFn))}return t(this,C)}};R=new WeakMap,C=new WeakMap,H=new WeakMap,Q=new WeakMap,W=new WeakMap,X=new WeakMap,ee=new WeakMap,te=new WeakMap,ie=new WeakMap,re=new WeakMap;ae.annotate(M);ae.annotate(w);ae.annotate(j,["SingleInputValidatorFactory"]);ae.annotate(U,["BaseFieldFactory"]);function ye(){let a=new be;return a.bind("FormElementRegistry").to(M).inTransientScope(),a.bind("SingleInputValidatorFactory").to(w).inSingletonScope(),a.bind("BaseFieldFactory").to(j).inSingletonScope(),a.bind("FormElementsParser").to(U).inTransientScope(),a}var ve=ye(),Ee=ve.get("FormElementsParser"),Fe=Ee.parseTemplate({fieldA:"a field",fieldB:{defaultValue:"field b",syncValidators:[me("Field B is required."),de("Field B must be an email.")]},fieldC:{defaultValue:"field c",syncValueControlFn:({fieldB:a})=>a.value.toUpperCase()},fieldD:{primaryDefaultValue:"field d",secondaryDefaultValue:"FIELD D",omitByDefault:!0}});for(let a in Fe)console.log(a),console.log(Fe[a].state);
//# sourceMappingURL=index.js.map