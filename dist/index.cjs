"use strict";var Ot=Object.defineProperty,wt=Object.defineProperties;var jt=Object.getOwnPropertyDescriptors;var Vt=Object.getOwnPropertySymbols;var Bt=Object.prototype.hasOwnProperty,_t=Object.prototype.propertyIsEnumerable;var At=(o,e,r)=>e in o?Ot(o,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[e]=r,h=(o,e)=>{for(var r in e||(e={}))Bt.call(e,r)&&At(o,r,e[r]);if(Vt)for(var r of Vt(e))_t.call(e,r)&&At(o,r,e[r]);return o},S=(o,e)=>wt(o,jt(e));var Ct=(o,e,r)=>{if(!e.has(o))throw TypeError("Cannot "+r)};var t=(o,e,r)=>(Ct(o,e,"read from private field"),r?r.call(o):e.get(o)),a=(o,e,r)=>{if(e.has(o))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(o):e.set(o,r)},l=(o,e,r,i)=>(Ct(o,e,"write to private field"),i?i.call(o,r):e.set(o,r),r);var te={autoTrim:!0,emailRegex:/^[A-Z0-9]+(?:[_%+.-][A-Z0-9]+)*@[A-Z0-9]+(?:[.-][A-Z0-9]+)\.[A-Z]{2,}$/i};function Dt(o,e){let r=te.emailRegex;return i=>{te.autoTrim&&(i=i.trim());let s={isValid:r.test(i)};return s.isValid?e&&(s.message=e):s.message=o,s}}function It(o,e){return r=>{te.autoTrim&&(r=r.trim());let i={isValid:r.length>0};return i.isValid?e&&(i.message=e):i.message=o,i}}var da=require("reflect-metadata"),Pt=require("inversify"),g=require("inversify-vanillajs-helpers");var Xe=require("rxjs");function V(o){process.env.NODE_ENV==="development"&&console.error(o)}var j,re,f,Ye=class{constructor(e,r){a(this,j,void 0);a(this,re,void 0);a(this,f,{});l(this,j,e),l(this,re,r)}evaluate(e){this.unsubscribeAll();let r={syncResult:{value:e,validity:2,messages:[{type:"PENDING",text:t(this,re)}]}};return r.observable=new Xe.Observable(i=>{let s={value:e,validity:4,messages:[]};for(let n=0;n<t(this,j).length;n++){let m=t(this,j)[n];try{let u=m(e),ee=(0,Xe.from)(u).subscribe(this.createValidatorObserver(s,i,n));t(this,f)[n]=ee}catch(u){this.createValidatorObserverErrorMethod(s,i)(u)}}}),r}createValidatorObserver(e,r,i){return{next:this.createValidatorObserverNextMethod(e,r,i),error:this.createValidatorObserverErrorMethod(e,r)}}createValidatorObserverNextMethod(e,r,i){return n=>{let{isValid:m,message:u}=n;m?(u&&e.messages.push({type:"VALID",text:u}),this.unsubscribeById(i),this.allValidatorsCompleted()&&(r.next(e),r.complete())):(this.unsubscribeAll(),e.validity=1,u&&e.messages.push({type:"INVALID",text:u}),r.next(e),r.complete())}}createValidatorObserverErrorMethod(e,r){return s=>{this.unsubscribeAll(),V(s),e.validity=0,e.messages.push({type:"ERROR",text:"An unexpected error occurred while validating the field."}),r.next(e),r.complete()}}unsubscribeAll(){for(let e in t(this,f))t(this,f)[e].unsubscribe();l(this,f,{})}unsubscribeById(e){t(this,f)[e].unsubscribe(),delete t(this,f)[e]}allValidatorsCompleted(){return Object.keys(t(this,f)).length===0}};j=new WeakMap,re=new WeakMap,f=new WeakMap;var ie,ae,et=class{constructor(e,r){a(this,ie,void 0);a(this,ae,void 0);l(this,ie,e),l(this,ae,r)}evaluate(e){let r=t(this,ie).evaluate(e);if(r.syncResult.validity<=1)return r;let i=t(this,ae).evaluate(e);return{syncResult:{value:i.syncResult.value,validity:i.syncResult.validity,messages:[...r.syncResult.messages,...i.syncResult.messages]},observable:i.observable}}};ie=new WeakMap,ae=new WeakMap;var se,tt=class{constructor(e){a(this,se,void 0);l(this,se,e)}evaluate(e){return{syncResult:this.evaluateSync(e)}}evaluateSync(e){let r={value:e,validity:4,messages:[]};try{for(let i of t(this,se)){let{isValid:s,message:n}=i(e);s||(r.validity=1),n&&r.messages.push({type:s?"VALID":"INVALID",text:n})}}catch(i){V(i),r.validity=0,r.messages.push({type:"ERROR",text:"An unexpected error occurred while validating the field."})}return r}};se=new WeakMap;var oe=class{createSingleInputValidatorSuite(e,r,i="Checking field..."){let s=new tt(e);if(r.length>0){let n=new Ye(r,i);return e.length>0?new et(s,n):n}else return s}};var bt=require("rxjs");var A,C,B,rt=class{constructor(e,r,i){a(this,A,!1);a(this,C,void 0);a(this,B,void 0);this.primaryField=e,this.secondaryField=r,l(this,B,i),l(this,C,t(this,B)),this.primaryField.stateChanges.subscribe(()=>{var s;t(this,A)||(s=this.stateChanges)==null||s.next(this.state)}),this.secondaryField.stateChanges.subscribe(()=>{var s;t(this,A)&&((s=this.stateChanges)==null||s.next(this.state))}),this.stateChanges=new bt.BehaviorSubject(this.state)}get state(){let e=t(this,A)?this.secondaryField.state:this.primaryField.state;return e.useSecondaryField=t(this,A),e.omit=t(this,C),e}set useSecondaryField(e){let r=this.useSecondaryField!==e;l(this,A,e),this.stateChanges&&r&&this.stateChanges.next(this.state)}get useSecondaryField(){return t(this,A)}set omit(e){var r;l(this,C,e),(r=this.stateChanges)==null||r.next(this.state)}get omit(){return t(this,C)}setValue(e){e.primaryFieldValue&&this.primaryField.setValue(e.primaryFieldValue),e.secondaryFieldValue&&this.secondaryField.setValue(e.secondaryFieldValue),e.useSecondaryField!==void 0&&(this.useSecondaryField=e.useSecondaryField)}setState(e){e.omit!==void 0&&(this.omit=e.omit),e.primaryFieldState&&this.primaryField.setState(e.primaryFieldState),e.secondaryFieldState&&this.secondaryField.setState(e.secondaryFieldState),e.useSecondaryField!==void 0&&(this.useSecondaryField=e.useSecondaryField)}reset(){l(this,C,t(this,B)),this.primaryField.reset(),this.secondaryField.reset(),this.useSecondaryField=!1}};A=new WeakMap,C=new WeakMap,B=new WeakMap;var vt=require("rxjs");function T(o){return JSON.parse(JSON.stringify(o))}var _,W,Z,M,x,it=class{constructor(e,r,i){a(this,_,void 0);a(this,W,void 0);a(this,Z,void 0);a(this,M,void 0);a(this,x,void 0);l(this,_,e),l(this,W,r),l(this,Z,i);let s=t(this,_).evaluate(t(this,W));l(this,M,S(h({},s.syncResult),{omit:t(this,Z)})),this.stateChanges=new vt.BehaviorSubject(this.state),s.observable&&this.handleValidityObservable(s.observable)}get state(){return T(t(this,M))}set omit(e){this.setState(S(h({},this.state),{omit:e}))}get omit(){return this.state.omit}setValue(e){t(this,x)&&t(this,x).unsubscribe();let r=t(this,_).evaluate(e);this.setState(S(h({},r.syncResult),{omit:this.state.omit})),r.observable&&this.handleValidityObservable(r.observable)}setState(e){l(this,M,T(e)),this.stateChanges.next(this.state)}reset(){t(this,M).omit=t(this,Z),this.setValue(t(this,W))}handleValidityObservable(e){var r;(r=t(this,x))==null||r.unsubscribe(),l(this,x,e.subscribe(i=>{this.setState(S(h({},i),{messages:[...this.state.messages.filter(s=>s.type!=="PENDING"),...i.messages],omit:this.state.omit}))}))}};_=new WeakMap,W=new WeakMap,Z=new WeakMap,M=new WeakMap,x=new WeakMap;var ne,le=class{constructor(e){a(this,ne,void 0);l(this,ne,e)}createField(e,r,i,s,n){let m=t(this,ne).createSingleInputValidatorSuite(i,s,n);return new it(m,e,r)}createDualField(e,r,i,s,n,m){let u=this.createField(e,!1,s,n,m),ee=this.createField(r,!1,s,n,m);return new rt(u,ee,i)}};ne=new WeakMap;var Et=require("rxjs");var N,G,U,D,de=class{constructor(e,r,i,s){a(this,N,void 0);a(this,G,void 0);a(this,U,void 0);a(this,D,void 0);this.userFacingFields=e,l(this,N,r),l(this,G,i),l(this,U,s),l(this,D,t(this,U)),t(this,G).messagesChanges.subscribe(()=>{var n;(n=this.stateChanges)==null||n.next(this.state)}),t(this,N).stateChanges.subscribe(()=>{var n;this.stateChanges&&((n=this.stateChanges)==null||n.next(this.state))}),this.stateChanges=new Et.BehaviorSubject(this.state)}get state(){return T(S(h({},t(this,N).state),{messages:[...t(this,G).messages,...t(this,N).state.messages],omit:t(this,D)}))}set omit(e){l(this,D,e),this.stateChanges&&this.stateChanges.next(this.state)}get omit(){return t(this,D)}reset(){l(this,D,t(this,U));for(let e in this.userFacingFields)this.userFacingFields[e].reset()}};N=new WeakMap,G=new WeakMap,U=new WeakMap,D=new WeakMap;var d,at=class{constructor(e){a(this,d,void 0);l(this,d,e),this.checkTemplate()}get isNestedForm(){return t(this,d)instanceof de}get isDualField(){return!this.isNestedForm&&typeof t(this,d)!="string"&&!("defaultValue"in t(this,d))}get baseObject(){return this.isNestedForm?t(this,d):this.isDualField?this.createBaseDualFieldObj():this.createBaseFieldObj()}get syncValueControlFn(){if(this.isSyncValueControlledField)return(this.isDualField?t(this,d):t(this,d)).syncValueControlFn}get asyncValueControlFn(){if(this.isAsyncValueControlledField)return(this.isDualField?t(this,d):t(this,d)).asyncValueControlFn}get syncStateControlFn(){if(this.isSyncStateControlledField)return(this.isDualField?t(this,d):t(this,d)).syncStateControlFn}get asyncStateControlFn(){if(this.isAsyncStateControlledField)return(this.isDualField?t(this,d):t(this,d)).asyncStateControlFn}get isSyncStateControlledField(){return!this.isNestedForm&&typeof t(this,d)!="string"&&"syncStateControlFn"in t(this,d)}get isSyncValueControlledField(){return!this.isNestedForm&&typeof t(this,d)!="string"&&"syncValueControlFn"in t(this,d)}get isAsyncStateControlledField(){return!this.isNestedForm&&typeof t(this,d)!="string"&&"asyncStateControlFn"in t(this,d)}get isAsyncValueControlledField(){return!this.isNestedForm&&typeof t(this,d)!="string"&&"asyncValueControlFn"in t(this,d)}checkTemplate(){if(typeof t(this,d)=="string"||t(this,d)instanceof de)return;if(typeof t(this,d)!="object")throw new Error(`FieldTemplateParser expected to receive argument of type <string | NestedFormImpl | object>. Received ${typeof t(this,d)}.`);if(!("defaultValue"in t(this,d))&&!("primaryDefaultValue"in t(this,d)&&"secondaryDefaultValue"in t(this,d)))throw new Error("Object passed to FormTemplateParser did not include properties defaultValue or both primaryDefaultValue and secondaryDefaultValue.");if("defaultValue"in t(this,d)&&("primaryDefaultValue"in t(this,d)||"secondaryDefaultValue"in t(this,d)))throw new Error("FieldTemplateParser received ambiguous object. Include only defaultValue or both primaryDefaultValue and secondaryDefaultValue.");let e=0;if(this.isSyncStateControlledField&&e++,this.isSyncValueControlledField&&e++,this.isAsyncStateControlledField&&e++,this.isAsyncValueControlledField&&e++,e>1)throw new Error("FieldTemplateParser received ambiguous object. Include only one type of control function.")}createBaseFieldObj(){if(typeof t(this,d)=="string")return{defaultValue:t(this,d),syncValidators:[],asyncValidators:[],omitByDefault:!1};{let e=t(this,d);return{defaultValue:e.defaultValue,syncValidators:e.syncValidators?e.syncValidators:[],asyncValidators:e.asyncValidators?e.asyncValidators:[],omitByDefault:!!e.omitByDefault,pendingAsyncValidatorMessage:e.pendingAsyncValidatorMessage}}}createBaseDualFieldObj(){let e=t(this,d);return{primaryDefaultValue:e.primaryDefaultValue,secondaryDefaultValue:e.secondaryDefaultValue,syncValidators:e.syncValidators?e.syncValidators:[],asyncValidators:e.asyncValidators?e.asyncValidators:[],omitByDefault:!!e.omitByDefault,pendingAsyncValidatorMessage:e.pendingAsyncValidatorMessage}}};d=new WeakMap;var z,y,c,ce,me,pe,ye,Fe,ge,fe,he,ue=class{constructor(e,r){a(this,z,void 0);a(this,y,void 0);a(this,c,{});a(this,ce,new Map);a(this,me,new Map);a(this,pe,new Map);a(this,ye,new Map);a(this,Fe,new Map);a(this,ge,new Map);a(this,fe,new Map);a(this,he,new Map);l(this,z,e),l(this,y,r)}parseTemplate(e){for(let r in e){let i=new at(e[r]);if(i.isNestedForm)t(this,c)[r]=i.baseObject;else if(i.isDualField){let s=i.baseObject;t(this,c)[r]=t(this,z).createDualField(s.primaryDefaultValue,s.secondaryDefaultValue,s.omitByDefault,s.syncValidators,s.asyncValidators,s.pendingAsyncValidatorMessage)}else{let s=i.baseObject;t(this,c)[r]=t(this,z).createField(s.defaultValue,s.omitByDefault,s.syncValidators,s.asyncValidators,s.pendingAsyncValidatorMessage)}i.syncStateControlFn?i.isDualField?t(this,Fe).set(r,i.syncStateControlFn):t(this,ce).set(r,i.syncStateControlFn):i.asyncStateControlFn?i.isDualField?t(this,fe).set(r,i.asyncStateControlFn):t(this,pe).set(r,i.asyncStateControlFn):i.syncValueControlFn?i.isDualField?t(this,ge).set(r,i.syncValueControlFn):t(this,me).set(r,i.syncValueControlFn):i.asyncValueControlFn&&(i.isDualField?t(this,he).set(r,i.asyncValueControlFn):t(this,ye).set(r,i.asyncValueControlFn))}for(let[r,i]of t(this,ce).entries())t(this,c)[r]=t(this,y).createStateControlledFieldWithSyncControlFn(t(this,c)[r],i,t(this,c));for(let[r,i]of t(this,me).entries())t(this,c)[r]=t(this,y).createValueControlledFieldWithSyncControlFn(t(this,c)[r],i,t(this,c));for(let[r,i]of t(this,pe).entries())t(this,c)[r]=t(this,y).createStateControlledFieldWithAsyncControlFn(t(this,c)[r],i,t(this,c));for(let[r,i]of t(this,ye).entries())t(this,c)[r]=t(this,y).createValueControlledFieldWithAsyncControlFn(t(this,c)[r],i,t(this,c));for(let[r,i]of t(this,Fe).entries())t(this,c)[r]=t(this,y).createStateControlledDualFieldWithSyncControlFn(t(this,c)[r],i,t(this,c));for(let[r,i]of t(this,ge).entries())t(this,c)[r]=t(this,y).createValueControlledDualFieldWithSyncControlFn(t(this,c)[r],i,t(this,c));for(let[r,i]of t(this,fe).entries())t(this,c)[r]=t(this,y).createStateControlledDualFieldWithAsyncControlFn(t(this,c)[r],i,t(this,c));for(let[r,i]of t(this,he).entries())t(this,c)[r]=t(this,y).createValueControlledDualFieldWithAsyncControlFn(t(this,c)[r],i,t(this,c));return t(this,c)}};z=new WeakMap,y=new WeakMap,c=new WeakMap,ce=new WeakMap,me=new WeakMap,pe=new WeakMap,ye=new WeakMap,Fe=new WeakMap,ge=new WeakMap,fe=new WeakMap,he=new WeakMap;var k,P,Se,I,H,st=class{constructor(e,r,i,s,n){a(this,k,void 0);a(this,P,void 0);a(this,Se,{});a(this,I,void 0);a(this,H,!1);this.subscribeToAccessedFields=()=>{if(!t(this,H)&&t(this,I)){let e=t(this,I).accessedFieldNames;for(let r of e)t(this,k)[r].stateChanges.subscribe(i=>{t(this,Se)[r]=i,t(this,P).updateTallies(r,i),t(this,H)&&this.aggregateChanges.next(this.aggregatedStateChanges)});this.accessedFields.setValue(e),l(this,I,null),l(this,H,!0)}};l(this,k,e),l(this,I,r),l(this,P,i),this.aggregateChanges=n.createOnInitialSubscriptionHandlingBehaviorSubject(t(this,I).getProxy(t(this,k))),this.accessedFields=s,this.aggregateChanges.onInitialSubscription(this.subscribeToAccessedFields)}get aggregatedStateChanges(){return S(h({},t(this,Se)),{overallValidity:t(this,P).validity,hasOmittedFields:t(this,P).omit})}};k=new WeakMap,P=new WeakMap,Se=new WeakMap,I=new WeakMap,H=new WeakMap;var Rt=require("rxjs");var L,ot=class{constructor(e){a(this,L,{});for(let r=0;r<e.length;r++)e[r].messageChanges.subscribe(s=>{s?t(this,L)[r]=s:delete t(this,L)[r],this.messagesChanges&&this.messagesChanges.next(this.messages)});this.messagesChanges=new Rt.BehaviorSubject(this.messages)}get messages(){return[...this.generateMessages()]}*generateMessages(){for(let e in t(this,L))yield T(t(this,L)[e])}};L=new WeakMap;var Ae,Ce,De,Ie,Ve=class{constructor(e,r,i,s){a(this,Ae,void 0);a(this,Ce,void 0);a(this,De,void 0);a(this,Ie,void 0);l(this,Ae,e),l(this,Ce,r),l(this,De,i),l(this,Ie,s)}createMultiFieldAggregatorFromFields(e){return new st(e,t(this,Ae).createAggregatedStateChangesProxyProducer(),t(this,Ce).createFieldStateReducer(),t(this,De).createOneTimeValueEmitter(),t(this,Ie))}createMultiInputValidatorMessagesAggregatorFromValidators(e){return new ot(e)}};Ae=new WeakMap,Ce=new WeakMap,De=new WeakMap,Ie=new WeakMap;var q,K,lt=class{constructor(e){a(this,q,void 0);a(this,K,new Set);l(this,q,e)}get validity(){return t(this,q).validity}get omit(){return t(this,K).size>0}updateTallies(e,r){let{validity:i,omit:s}=r;t(this,q).updateTallies(e,i),s?t(this,K).add(e):t(this,K).delete(e)}};q=new WeakMap,K=new WeakMap;var Tt=require("rxjs");var b,be,nt=class{constructor(e){a(this,b,void 0);a(this,be,[]);l(this,b,e),this.validityChanges=new Tt.BehaviorSubject(t(this,b).validity)}get validity(){return t(this,b).validity}addValidator(e){let r=String(t(this,be).length);t(this,be).push(e),e.overallValidityChanges.subscribe(i=>{t(this,b).updateTallies(r,i),this.validityChanges.next(t(this,b).validity)})}};b=new WeakMap,be=new WeakMap;var p=(u=>(u[u.FINALIZER_ERROR=0-1]="FINALIZER_ERROR",u[u.FIELD_ERROR=void 0]="FIELD_ERROR",u[u.FIELD_INVALID=void 0]="FIELD_INVALID",u[u.FIELD_PENDING=void 0]="FIELD_PENDING",u[u.FIELD_VALID_UNFINALIZABLE=void 0]="FIELD_VALID_UNFINALIZABLE",u[u.VALID_FINALIZING=void 0]="VALID_FINALIZING",u[u.VALID_FINALIZED=void 0]="VALID_FINALIZED",u))(p||{});var ve,Ee,Re,Te,Me,xe,dt=class{constructor(){a(this,ve,new Set);a(this,Ee,new Set);a(this,Re,new Set);a(this,Te,new Set);a(this,Me,new Set);a(this,xe,new Set)}get finalizerValidity(){return t(this,ve).size>0?p.FINALIZER_ERROR:t(this,Ee).size>0?p.FIELD_ERROR:t(this,Re).size>0?p.FIELD_INVALID:t(this,Te).size>0?p.FIELD_PENDING:t(this,Me).size>0?p.FIELD_VALID_UNFINALIZABLE:t(this,xe).size>0?p.VALID_FINALIZING:p.VALID_FINALIZED}updateTallies(e,r){this.updateTally(e,r,p.FINALIZER_ERROR,t(this,ve)),this.updateTally(e,r,p.FIELD_ERROR,t(this,Ee)),this.updateTally(e,r,p.FIELD_INVALID,t(this,Re)),this.updateTally(e,r,p.FIELD_PENDING,t(this,Te)),this.updateTally(e,r,p.FIELD_VALID_UNFINALIZABLE,t(this,Me)),this.updateTally(e,r,p.VALID_FINALIZING,t(this,xe))}updateTally(e,r,i,s){r===i?s.add(e):s.delete(e)}};ve=new WeakMap,Ee=new WeakMap,Re=new WeakMap,Te=new WeakMap,Me=new WeakMap,xe=new WeakMap;var Mt=require("rxjs");var v,Ne,ut=class{constructor(e){a(this,v,void 0);a(this,Ne,[]);l(this,v,e),this.validityChanges=new Mt.BehaviorSubject(t(this,v).validity)}get validity(){return t(this,v).validity}addValidator(e){let r=String(t(this,Ne).length);t(this,Ne).push(e),e.calculatedValidityChanges.subscribe(i=>{t(this,v).updateTallies(r,i),this.validityChanges.next(t(this,v).validity)})}};v=new WeakMap,Ne=new WeakMap;var Pe,Le,Oe,we,ct=class{constructor(){a(this,Pe,new Set);a(this,Le,new Set);a(this,Oe,new Set);a(this,we,new Set)}get validity(){return t(this,Pe).size>0?0:t(this,Le).size>0?1:t(this,Oe).size>0?2:t(this,we).size>0?3:4}updateTallies(e,r){this.updateTally(e,r,0,t(this,Pe)),this.updateTally(e,r,1,t(this,Le)),this.updateTally(e,r,2,t(this,Oe)),this.updateTally(e,r,3,t(this,we))}updateTally(e,r,i,s){r===i?s.add(e):s.delete(e)}};Pe=new WeakMap,Le=new WeakMap,Oe=new WeakMap,we=new WeakMap;var je=class{createFieldStateReducer(){return new lt(this.createValidityReducer())}createFinalizerValidityReducer(){return new dt}createUserMultiInputValidatorValidityReducer(){return new ut(this.createValidityReducer())}createFinalizerFacingMultiInputValidatorValidityReducer(){throw new nt(this.createValidityReducer())}createValidityReducer(){return new ct}};var mt=class{constructor(e){this.accessedFieldNames=new Set;this.fieldStateReducer=e}getProxy(e){let r={};for(let n in e)r[n]=e[n].state;let i=this.fieldStateReducer,s=this.accessedFieldNames;return new Proxy(r,{get(n,m){if(m==="overallValidity")return i.validity;if(m==="hasOmittedFields")return i.omit;{let u=m.toString();if(!(m in e)||u==="constructor")return n[u];s.add(u);let ee=n[u];return i.updateTallies(u,ee),n[u]}}})}};var _e,Be=class{constructor(e){a(this,_e,void 0);l(this,_e,e)}createAggregatedStateChangesProxyProducer(){return new mt(t(this,_e).createFieldStateReducer())}};_e=new WeakMap;var J,Y,pt=class{constructor(){a(this,J,!1);a(this,Y,void 0)}onEvent(e){t(this,J)?e():l(this,Y,e)}triggerEvent(){t(this,J)||(l(this,J,!0),t(this,Y)&&t(this,Y).call(this))}};J=new WeakMap,Y=new WeakMap;var E,$,yt=class{constructor(){a(this,E,void 0);a(this,$,void 0)}onValue(e){t(this,E)?e(t(this,E)):l(this,$,e)}setValue(e){t(this,E)||(l(this,E,e),t(this,$)&&t(this,$).call(this,t(this,E)))}};E=new WeakMap,$=new WeakMap;var We=class{createOneTimeEventEmitter(){return new pt}createOneTimeValueEmitter(){return new yt}};var xt=require("rxjs");var Q,Ft=class extends xt.BehaviorSubject{constructor(r,i){super(r);a(this,Q,void 0);l(this,Q,i)}subscribe(r,i,s){let n;return r?typeof r=="function"?n=super.subscribe(r,i,s):n=super.subscribe(r):n=super.subscribe(),t(this,Q).triggerEvent(),n}onInitialSubscription(r){t(this,Q).onEvent(r)}};Q=new WeakMap;var Ge,Ze=class{constructor(e){a(this,Ge,void 0);l(this,Ge,e)}createOnInitialSubscriptionHandlingBehaviorSubject(e){return new Ft(e,t(this,Ge).createOneTimeEventEmitter())}};Ge=new WeakMap;var ft=require("rxjs");var Ue,ze,gt=class{constructor(e,r){a(this,Ue,void 0);a(this,ze,void 0);l(this,Ue,r),this.stream=new ft.ReplaySubject(1),t(this,Ue).aggregateChanges.subscribe(i=>{var s;(s=t(this,ze))==null||s.unsubscribe();try{let n=e(i);l(this,ze,(0,ft.from)(n).subscribe({next:m=>this.stream.next(m),error:m=>{V(m),this.stream.error(m)}}))}catch(n){V(n),this.stream.error(n)}})}};Ue=new WeakMap,ze=new WeakMap;var Nt=require("rxjs");var ke,ht=class{constructor(e,r){a(this,ke,void 0);l(this,ke,r),this.stream=new Nt.ReplaySubject(1),t(this,ke).aggregateChanges.subscribe(i=>{try{let s=e(i);this.stream.next(s)}catch(s){V(s),this.stream.error(s)}})}};ke=new WeakMap;var X,He=class{constructor(e){a(this,X,void 0);l(this,X,e)}createSyncAdapterFromFnWithFields(e,r){let i=t(this,X).createMultiFieldAggregatorFromFields(r);return new ht(e,i)}createAsyncAdapterFromFnWithFields(e,r){let i=t(this,X).createMultiFieldAggregatorFromFields(r);return new gt(e,i)}};X=new WeakMap;var O=class{get stateChanges(){return this.field.stateChanges}get state(){return this.field.state}set omit(e){this.field.omit=e}get omit(){return this.field.omit}constructor(e,r){this.field=e,this.adapter=r,this.adapter.stream.subscribe({next:i=>this.setState(i),error:()=>{this.setState({value:"",validity:0,messages:[{type:"ERROR",text:"An unexpected error occurred while generating this field's value."}]})}})}setValue(e){this.field.setValue(e)}setState(e){this.field.setState(e)}reset(){this.field.reset()}};var qe=class extends O{get primaryField(){return this.dualField.primaryField}get secondaryField(){return this.dualField.secondaryField}set useSecondaryField(e){this.dualField.useSecondaryField=e}get useSecondaryField(){return this.dualField.useSecondaryField}get dualField(){return this.field}constructor(e,r){super(e,r)}setValue(e){super.setValue(e)}setState(e){super.setState(e)}};var w=class{get stateChanges(){return this.field.stateChanges}get state(){return this.field.state}set omit(e){this.field.omit=e}get omit(){return this.field.omit}constructor(e,r){this.field=e,this.adapter=r,this.adapter.stream.subscribe({next:i=>{i&&this.setValue(i)},error:()=>{this.setState({value:"",validity:0,messages:[{type:"ERROR",text:"An unexpected error occurred while generating this field's value."}]})}})}setValue(e){this.field.setValue(e)}setState(e){this.field.setState(e)}reset(){this.field.reset()}};var Ke=class extends w{get primaryField(){return this.dualField.primaryField}get secondaryField(){return this.dualField.secondaryField}set useSecondaryField(e){this.dualField.useSecondaryField=e}get useSecondaryField(){return this.dualField.useSecondaryField}get dualField(){return this.field}constructor(e,r){super(e,r)}setValue(e){super.setValue(e)}setState(e){super.setState(e)}};var F,Je=class{constructor(e){a(this,F,void 0);l(this,F,e)}createStateControlledFieldWithSyncControlFn(e,r,i){let s=t(this,F).createSyncAdapterFromFnWithFields(r,i);return new O(e,s)}createStateControlledFieldWithAsyncControlFn(e,r,i){let s=t(this,F).createAsyncAdapterFromFnWithFields(r,i);return new O(e,s)}createValueControlledFieldWithSyncControlFn(e,r,i){let s=t(this,F).createSyncAdapterFromFnWithFields(r,i);return new w(e,s)}createValueControlledFieldWithAsyncControlFn(e,r,i){let s=t(this,F).createAsyncAdapterFromFnWithFields(r,i);return new w(e,s)}createStateControlledDualFieldWithSyncControlFn(e,r,i){let s=t(this,F).createSyncAdapterFromFnWithFields(r,i);return new qe(e,s)}createStateControlledDualFieldWithAsyncControlFn(e,r,i){let s=t(this,F).createAsyncAdapterFromFnWithFields(r,i);return new qe(e,s)}createValueControlledDualFieldWithSyncControlFn(e,r,i){let s=t(this,F).createSyncAdapterFromFnWithFields(r,i);return new Ke(e,s)}createValueControlledDualFieldWithAsyncControlFn(e,r,i){let s=t(this,F).createAsyncAdapterFromFnWithFields(r,i);return new Ke(e,s)}};F=new WeakMap;g.helpers.annotate(oe);g.helpers.annotate(je);g.helpers.annotate(We);g.helpers.annotate(Ze,["EmitterFactory"]);g.helpers.annotate(Be,["ReducerFactory"]);g.helpers.annotate(le,["SingleInputValidatorFactory"]);g.helpers.annotate(Ve,["ProxyProducerFactory","ReducerFactory","EmitterFactory","SubjectFactory"]);g.helpers.annotate(He,["AggregatorFactory"]);g.helpers.annotate(Je,["AdapterFactory"]);g.helpers.annotate(ue,["BaseFieldFactory","ControlledFieldFactory"]);function Lt(){let o=new Pt.Container;return o.bind("SingleInputValidatorFactory").to(oe).inSingletonScope(),o.bind("BaseFieldFactory").to(le).inSingletonScope(),o.bind("ReducerFactory").to(je).inSingletonScope(),o.bind("EmitterFactory").to(We).inSingletonScope(),o.bind("SubjectFactory").to(Ze).inSingletonScope(),o.bind("ProxyProducerFactory").to(Be).inSingletonScope(),o.bind("AggregatorFactory").to(Ve).inSingletonScope(),o.bind("AdapterFactory").to(He).inSingletonScope(),o.bind("ControlledFieldFactory").to(Je).inSingletonScope(),o.bind("FormElementsParser").to(ue).inTransientScope(),o}var Wt=Lt(),Zt=Wt.get("FormElementsParser"),St=Zt.parseTemplate({fieldA:"a field",fieldB:{defaultValue:"field b",syncValidators:[It("Field B is required."),Dt("Field B must be an email.")]},fieldC:{defaultValue:"field c",syncValueControlFn:({fieldB:o})=>{if(!(o.validity<4))return o.value.toUpperCase()}},fieldD:{primaryDefaultValue:"field d",secondaryDefaultValue:"FIELD D",omitByDefault:!0}});St.fieldB.setValue("new value in field B");St.fieldB.setValue("user@example.com");for(let o in St)console.log(o),console.log(St[o].state);
//# sourceMappingURL=index.cjs.map